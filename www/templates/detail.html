{% extends 'base.html' %}
{% load static %}

{% block content %}
	<div class="col-md-8 col-md-offset-2">
    <a href='{% url "posts:read" %}'><h1>STTLD.</h1></a>
    <div class="col-m-8">
        <div class="thumbnail">
            <div class="caption">
            
            <h3>{{ instance.title }}<br><small class="timestamp">Posted {{ instance.created_at|timesince }} ago</small></h3>
            {% if instance.draft %} 
                <p style="color:red;">DRAFT</p>
            {% endif%}
            
            {% if instance.image_a %}
            <img src="{{instance.image_a.url }}" class="img-responsive"/>
            {% endif %}
            <p>{{ instance.option_a }}</p>
            {% if instance.image_b %}
            <img src="{{instance.image_b.url }}" class="img-responsive"/>
            {% endif %}
            <p>{{ instance.option_b }}</p>
            {% if instance.user.get_full_name %}
            <p>Posted by: {{ instance.user.get_full_name }}</p>
            {% endif %}
            {% for vote in votes %}
            <p>votes: {{ vote.vote_count }}, vote for: {{ vote.vote_index }}, from: {{ vote.user.first_name }}</p>
            {% endfor %}
            



            <p><div class="fb-like" data-href="{{ request.build_absolute_uri }}" data-layout="standard" data-action="like" data-size="small" data-show-faces="true" data-share="true"></div></p>

            <!-- <p><div class="fb-share-button" data-href="{{ request.build_absolute_uri }}"  data-size="small" data-mobile-iframe="true"></div></p> -->
            <div>
                <p class="lead">Comments</p>
                <form method="POST" action="."> {% csrf_token %}
                    {{ comment_form }}
                    <input type="submit" value="Post Comment" class="btn btn-default">
                    
                </form>
                {% for comment in comments %}

                    <blockquote>
                        <p>{{ comment.content }}</p>
                        <footer>from {{ comment.user.first_name }} on {{ comment.timestamp }}
                            {% if comment.children.count > 0 %}
                                {{comment.children.count }}
                                Comments
                            {% endif %}
                            <a href="#" class="comment-reply-btn">Reply</a>
                        </footer>
                        
                        <div class="comment-reply">
                            {% for child_comment in comment.children %}
                            <blockquote>
                            <p>{{ child_comment.content }}</p>
                            <footer>from {{ child_comment.user.first_name }} on {{ child_comment.timestamp }}</footer>
                            
                            </blockquote>
                            {% endfor %}

                            <form method="POST" action="."> {% csrf_token %}
                            {{ comment_form }}
                            <input type="hidden" name="parent_id" value="{{ comment.id }}">
                            <input type="submit" value="Reply" class="btn btn-default">
                        
                            </form>
                        </div>

                    </blockquote>
                    <hr/>
                {% endfor %}
            </div>

            <p>Last updated on {{ instance.updated_at }}</p>  
            </div>
            
        </div>
    
    </div>
    	
    </div>
{% endblock %}